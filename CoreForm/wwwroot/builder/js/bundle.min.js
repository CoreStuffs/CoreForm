function RegisterField(n){registeredFields.set(n.type,n)}function openSettings(n){var t,i;editFormModal.show();t=findSchemaObjectById(n);i=registeredFields.get(t.type).editForm;app.editformdata=t}function applyToolbarEvents(){$(".sortable-item").mousemove(function(n){n.stopPropagation();$(".toolbar").hide();$(this).find("> .toolbar").show()});$(".sortable-item").mouseleave(function(){event.stopPropagation();$(this).find("> .toolbar").hide()})}function configureNestedTables(){for(var t=[].slice.call(document.querySelectorAll(".nested-sortable")),n=0;n<t.length;n++)configureNestedTable(t[n])}function configureNestedTable(n){new Sortable(n,{group:{name:"share"},draggale:".sortable-item",handle:".moveHandle",animation:150,fallbackOnBody:!0,swapThreshold:.25,ghostClass:"sortable-ghost",dragClass:"sortable-dragitem",onAdd:function(n){var t;if(n.pullMode==="clone"){var r=$(n.item),u=function(n){var u=component.GetEditFieldTemplate(n),i,f;u!=""&&(i=$(u),r.replaceWith(i),f=r.data("type"),i.attr("data-type",f),i.attr("data-name",t),i.attr("id","ctrl_"+ctrlIndex++),n!=null&&i.data("config",n),configureNestedTables())},i=component.GetFieldConfiguration(null);if(i!==null){$("#editForm .modal-body").html(i.htmlForm);vm=new Vue({el:"#editForm",data:i.dataModel});$("#editForm").modal("show").on("hide.bs.modal",function(){t=$("#ctrlName").val();t===""?$(n.item).remove():u(vm.$data)})}else u(null)}},onEnd:function(n){var e=n.item,t,i;n.to;n.from;n.oldIndex;n.newIndex;n.oldDraggableIndex;n.newDraggableIndex;n.clone;n.pullMode;var f=findSchemaObjectById($(n.clone).data("ref")),r=findDataCollectionByElement($(n.from)),u=findDataCollectionByElement($(n.to));typeof f!="undefined"&&typeof r!="undefined"&&typeof u!="undefined"&&(t=n.newDraggableIndex,i=n.oldDraggableIndex,r===u&&(t>i?t++:i++),u.splice(t,0,f),r.splice(i,1))}})}function findSchemaObjectById(n){return n==="formContainer"?app.schema:findDataObjectByDataNode(app.schema,n)}function findDataObjectByDataNode(n,t){var i=null,r,u;if(typeof n.columns!="undefined"&&(i=n.columns),typeof n.fields!="undefined"&&(i=n.fields),t===n.id)return n;if(i!=null)for(r=0;r<i.length;r++)if(u=findDataObjectByDataNode(i[r],t),u!=null)return u;return null}function findDataCollectionByElement(n){var t=null;return($(n).attr("id")?t=$(n).attr("id"):$(n).data("ref")&&(t=$(n).data("ref")),t==="formContainer")?app.schema.fields:findDataCollectionInDataNode(app.schema,t)}function findDataCollectionInDataNode(n,t){var i=null,r,u;if(typeof n.columns!="undefined"&&(i=n.columns),typeof n.fields!="undefined"&&(i=n.fields),i==null)return null;if(t===n.id)return i;for(r=0;r<i.length;r++)if(u=findDataCollectionInDataNode(i[r],t),u!=null)return u;return null}var id=100,app,editFormModal,registeredFields=new Map;$(document).ready(function(){app=new Vue({el:"#app",data:function(){return{data:{},schema:{schemaVersion:1,formVersion:0,name:"FirstSchema",fields:[]},editformdata:{}}},methods:{addTxt:function(){id++;this.schema.fields.push({id:"ctrl_"+id,label:"Name",type:"textField",width:12})},addSel:function(){id++;this.schema.fields.push({id:"ctrl_"+id,label:"Country",type:"selectField",source:"country123"})},applyEdit:function(){var n=findSchemaObjectById(this.editformdata.id);n.label=this.editformdata.label},saveSchema:function(){$.ajax({url:"/Form/NewModel",type:"POST",data:JSON.stringify(this.schema),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){alert("Data Loaded: "+n)}})}},created:function(){for(let[n,t]of registeredFields.entries())this.$options.components[n]=t.fieldTemplate,this.$options.components["edit_"+n]=t.editForm;for(let[,n]of Object.entries(this.$options.components))n.components=this.$options.components},updated:function(){this.$nextTick(function(){applyToolbarEvents()})},mounted:function(){this.$nextTick(function(){applyToolbarEvents();configureNestedTables();M.updateTextFields();M.AutoInit();$("select").not(".select2").not(".select2-ajax").formSelect();editFormModal=UIkit.modal(document.getElementById("editForm"))})}})});Vue.component("cf_toolbutton",{template:`<div v-on:click="click()" :class="'toolbar-button ' + cssclass"><img :src="'./img/'+ icon +'.svg'"/></div>`,data:function(){return{}},props:["onclick","cssclass","icon"],methods:{click:function(){eval(this.onclick)}}});Vue.component("cf_field",{template:`<div :data-ref="id" class="sortable-item"><div class="toolbar"><cf_toolbutton icon="move" cssclass="moveHandle"/><cf_toolbutton icon="settings" :onclick="'openSettings(&quot;'+ id +'&quot;)'"/><cf_toolbutton icon="trash" cssclass="deleteHandle"/></div><slot></slot></div>`,data:function(){return{}},props:["id"]});RegisterField({type:"grid",display:"Columns",fieldTemplate:{template:`<cf_field :id="id"><div class="row gridrow">
			    <div :class="'col nested-sortable s12 m' + column.width" :id="column.id" :data-column="index" :data-grid="id" v-for="(column,index) in columns">  
				<component v-for="field in column.fields" 
				 :key="field.id"
                 
				 :is="field.type"
				 v-model="$root.data[field.id]"
				 v-bind="field"></component>
			</div></div></cf_field>`,data:function(){return this.width===undefined&&(this.width=12),{}},computed:{},props:["id","label","value","columns"]},editForm:{template:`<div>Test Grid</div>`,data:function(){return{}}}});RegisterField({type:"textField",display:"Input field",fieldTemplate:{template:`<cf_field :id="id"><label :for="id" class="uk-form-label">{{ label }}</label><div class="uk-form-controls"><input type="text" class="uk-input uk-form-small" :id="id" :value="value" @input="updateInput"></div></cf_field>`,data:function(){return this.width===undefined&&(this.width=12),{}},computed:{},methods:{updateInput:function(){this.$emit("input",this.$el.getElementsByTagName("input")[0].value)}},props:["label","id","value","width"]},editForm:{template:`<div>
                        <div>
                            <input type="text" class="uk-input uk-form-small" name="txtWidth" v-model="width"/></div>
                        <div>
                            <input type="text" class="uk-input uk-form-small" name="txtLabel" v-model="label"/></div>
                    </div>`,computed:{},methods:{updateInput:function(){this.$emit("input",{label:this.$el.getElementsByTagName("input")[1].value,width:this.$el.getElementsByTagName("input")[0].value,id:this.id,type:this.type})}},props:["label","id","value","width","type"]}});RegisterField({type:"selectField",display:"Dropdown select",fieldTemplate:{template:`<cf_field :id="id"><label :for="id" class="uk-form-label">{{ label }}</label>
<div class="uk-form-control">
	<select @change="changeValue" class="select2 no-autoinit uk-select" v-model="id" :id="id" :name="id">
	</select></div>
	</cf_field>`,data:function(){return this.width===undefined&&(this.width=12),{}},methods:{changeValue:function(n){this.$emit("input",n.srcElement.value)}},computed:{},props:["label","id","options","value","width","source"],mounted:function(){var t=this,i=$(this.$el).find("select"),n={data:this.options};this.source!=undefined&&(n={ajax:{url:function(n){return n.term===undefined?"https://restcountries.eu/rest/v2/all?fields=name;flag;alpha3Code":"https://restcountries.eu/rest/v2/name/"+n.term+"?fields=name;flag;alpha3Code"},dataType:"json",delay:250,processResults:function(n,t){t.page=t.page||1;for(var i=0;i<n.length;i++)n[i].id=n[i].alpha3Code,n[i].text=n[i].name;return{results:n}},cache:!0},minimumInputLength:this.source.minimumInputLength,multiple:"multiple"});i.select2(n).val(this.value).trigger("change").on("change",function(){t.$emit("input",$(this).val())})},watch:{value:function(n){$(this.$el).val(n).trigger("change")},options:function(n){$(this.$el).empty().select2({data:n})}},destroyed:function(){}},editForm:{template:`<div>Test Textbox {{id}}</div>`}});